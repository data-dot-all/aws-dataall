from itertools import chain

from dataall.db.permissions import TENANT_ALL, TENANT_ALL_WITH_DESC, RESOURCES_ALL, RESOURCES_ALL_WITH_DESC, \
    ENVIRONMENT_INVITED, ENVIRONMENT_INVITATION_REQUEST, ENVIRONMENT_ALL
from dataall.modules.datasets_base.services.permissions import DATASET_TABLE_READ

MANAGE_DATASETS = 'MANAGE_DATASETS'

TENANT_ALL.append(MANAGE_DATASETS)
TENANT_ALL_WITH_DESC[MANAGE_DATASETS] = 'Manage datasets'

"""
DATASET PERMISSIONS
"""

GET_DATASET = 'GET_DATASET'
LIST_DATASETS = 'LIST_DATASETS'
LIST_DATASET_TABLES = 'LIST_DATASET_TABLES'
LIST_DATASET_SHARES = 'LIST_DATASET_SHARES'
LIST_DATASET_FOLDERS = 'LIST_DATASET_FOLDERS'
CREDENTIALS_DATASET = 'CREDENTIALS_DATASET'

DATASET_READ = [
    GET_DATASET,
    LIST_DATASETS,
    LIST_DATASET_TABLES,
    LIST_DATASET_SHARES,
    LIST_DATASET_FOLDERS,
    CREDENTIALS_DATASET,
]


UPDATE_DATASET = 'UPDATE_DATASET'
SYNC_DATASET = 'SYNC_DATASET'
SUMMARY_DATASET = 'SUMMARY_DATASET'
IMPORT_DATASET = 'IMPORT_DATASET'
UPLOAD_DATASET = 'UPLOAD_DATASET'
URL_DATASET = 'URL_DATASET'
CRAWL_DATASET = 'CRAWL_DATASET'
DELETE_DATASET = 'DELETE_DATASET'
STACK_DATASET = 'STACK_DATASET'
SUBSCRIPTIONS_DATASET = 'SUBSCRIPTIONS_DATASET'
CREATE_DATASET_TABLE = 'CREATE_DATASET_TABLE'
DELETE_DATASET_TABLE = 'DELETE_DATASET_TABLE'
UPDATE_DATASET_TABLE = 'UPDATE_DATASET_TABLE'
PROFILE_DATASET_TABLE = 'PROFILE_DATASET_TABLE'
CREATE_DATASET_FOLDER = 'CREATE_DATASET_FOLDER'
DELETE_DATASET_FOLDER = 'DELETE_DATASET_FOLDER'
GET_DATASET_FOLDER = 'DELETE_DATASET_FOLDER'
UPDATE_DATASET_FOLDER = 'UPDATE_DATASET_FOLDER'

DATASET_WRITE = [
    UPDATE_DATASET,
    SYNC_DATASET,
    SUMMARY_DATASET,
    IMPORT_DATASET,
    UPLOAD_DATASET,
    CREDENTIALS_DATASET,
    URL_DATASET,
    CRAWL_DATASET,
    DELETE_DATASET,
    STACK_DATASET,
    SUBSCRIPTIONS_DATASET,
    UPDATE_DATASET_TABLE,
    DELETE_DATASET_TABLE,
    CREATE_DATASET_TABLE,
    PROFILE_DATASET_TABLE,
    LIST_DATASET_SHARES,
    CREATE_DATASET_FOLDER,
    DELETE_DATASET_FOLDER,
    UPDATE_DATASET_FOLDER,
    LIST_DATASET_FOLDERS,
]

DATASET_ALL = list(set(DATASET_WRITE + DATASET_READ))
RESOURCES_ALL.extend(DATASET_ALL)


RESOURCES_ALL.extend(DATASET_TABLE_READ)

"""
DATASET PERMISSIONS FOR ENVIRONMENT
"""

CREATE_DATASET = 'CREATE_DATASET'
LIST_ENVIRONMENT_DATASETS = 'LIST_ENVIRONMENT_DATASETS'

ENVIRONMENT_INVITED.append(CREATE_DATASET)
ENVIRONMENT_INVITED.append(LIST_ENVIRONMENT_DATASETS)

ENVIRONMENT_INVITATION_REQUEST.append(CREATE_DATASET)
ENVIRONMENT_INVITATION_REQUEST.append(LIST_ENVIRONMENT_DATASETS)

ENVIRONMENT_ALL.append(CREATE_DATASET)
ENVIRONMENT_ALL.append(LIST_ENVIRONMENT_DATASETS)

RESOURCES_ALL.append(CREATE_DATASET)
RESOURCES_ALL.append(LIST_ENVIRONMENT_DATASETS)


for perm in chain(DATASET_ALL, DATASET_TABLE_READ):
    RESOURCES_ALL_WITH_DESC[perm] = perm

RESOURCES_ALL_WITH_DESC[CREATE_DATASET] = 'Create datasets on this environment'
RESOURCES_ALL_WITH_DESC[LIST_ENVIRONMENT_DATASETS] = "List datasets on this environment"
